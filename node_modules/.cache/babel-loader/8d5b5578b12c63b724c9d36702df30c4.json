{"ast":null,"code":"import _toConsumableArray from\"/Users/pranavmainkar/Sites/photogallery-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/Users/pranavmainkar/Sites/photogallery-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _createForOfIteratorHelper from\"/Users/pranavmainkar/Sites/photogallery-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createForOfIteratorHelper\";import _asyncToGenerator from\"/Users/pranavmainkar/Sites/photogallery-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/Users/pranavmainkar/Sites/photogallery-app/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{useState,useEffect}from\"react\";import{useCamera}from'@ionic/react-hooks/camera';import{useFilesystem,base64FromPath}from'@ionic/react-hooks/filesystem';import{useStorage}from'@ionic/react-hooks/storage';import{isPlatform}from'@ionic/react';import{CameraResultType,CameraSource,Capacitor,FilesystemDirectory}from\"@capacitor/core\";var PHOTO_STORAGE=\"photos\";export function usePhotoGallery(){var _useState=useState([]),_useState2=_slicedToArray(_useState,2),photos=_useState2[0],setPhotos=_useState2[1];var _useCamera=useCamera(),getPhoto=_useCamera.getPhoto;var _useFilesystem=useFilesystem(),deleteFile=_useFilesystem.deleteFile,getUri=_useFilesystem.getUri,readFile=_useFilesystem.readFile,writeFile=_useFilesystem.writeFile;var _useStorage=useStorage(),get=_useStorage.get,set=_useStorage.set;useEffect(function(){var loadSaved=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var photosString,photosInStorage,_iterator,_step,photo,file;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return get(PHOTO_STORAGE);case 2:photosString=_context.sent;photosInStorage=photosString?JSON.parse(photosString):[];// If running on the web...\nif(isPlatform('hybrid')){_context.next=24;break;}_iterator=_createForOfIteratorHelper(photosInStorage);_context.prev=6;_iterator.s();case 8:if((_step=_iterator.n()).done){_context.next=16;break;}photo=_step.value;_context.next=12;return readFile({path:photo.filepath,directory:FilesystemDirectory.Data});case 12:file=_context.sent;// Web platform only: Load photo as base64 data\nphoto.webviewPath=\"data:image/jpeg;base64,\".concat(file.data);case 14:_context.next=8;break;case 16:_context.next=21;break;case 18:_context.prev=18;_context.t0=_context[\"catch\"](6);_iterator.e(_context.t0);case 21:_context.prev=21;_iterator.f();return _context.finish(21);case 24:setPhotos(photosInStorage);case 25:case\"end\":return _context.stop();}}},_callee,null,[[6,18,21,24]]);}));return function loadSaved(){return _ref.apply(this,arguments);};}();loadSaved();},[get,readFile]);var takePhoto=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var cameraPhoto,fileName,savedFileImage,newPhotos;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return getPhoto({resultType:CameraResultType.Uri,source:CameraSource.Camera,quality:100});case 2:cameraPhoto=_context2.sent;fileName=new Date().getTime()+'.jpeg';_context2.next=6;return savePicture(cameraPhoto,fileName);case 6:savedFileImage=_context2.sent;newPhotos=[savedFileImage].concat(_toConsumableArray(photos));set(PHOTO_STORAGE,JSON.stringify(newPhotos));case 9:case\"end\":return _context2.stop();}}},_callee2);}));return function takePhoto(){return _ref2.apply(this,arguments);};}();var savePicture=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(photo,fileName){var base64Data,file,savedFile;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:if(!isPlatform('hybrid')){_context3.next=7;break;}_context3.next=3;return readFile({path:photo.path});case 3:file=_context3.sent;base64Data=file.data;_context3.next=10;break;case 7:_context3.next=9;return base64FromPath(photo.webPath);case 9:base64Data=_context3.sent;case 10:_context3.next=12;return writeFile({path:fileName,data:base64Data,directory:FilesystemDirectory.Data});case 12:savedFile=_context3.sent;if(!isPlatform('hybrid')){_context3.next=17;break;}return _context3.abrupt(\"return\",{filepath:savedFile.uri,webviewPath:Capacitor.convertFileSrc(savedFile.uri)});case 17:return _context3.abrupt(\"return\",{filepath:fileName,webviewPath:photo.webPath});case 18:case\"end\":return _context3.stop();}}},_callee3);}));return function savePicture(_x,_x2){return _ref3.apply(this,arguments);};}();var deletePhoto=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(photo){var newPhotos,filename;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:// Remove this photo from the Photos reference data array\nnewPhotos=photos.filter(function(p){return p.filepath!==photo.filepath;});// Update photos array cache by overwriting the existing photo array\nset(PHOTO_STORAGE,JSON.stringify(newPhotos));// delete photo file from filesystem\nfilename=photo.filepath.substr(photo.filepath.lastIndexOf('/')+1);_context4.next=5;return deleteFile({path:filename,directory:FilesystemDirectory.Data});case 5:setPhotos(newPhotos);case 6:case\"end\":return _context4.stop();}}},_callee4);}));return function deletePhoto(_x3){return _ref4.apply(this,arguments);};}();return{deletePhoto:deletePhoto,photos:photos,takePhoto:takePhoto};}","map":{"version":3,"sources":["/Users/pranavmainkar/Sites/photogallery-app/src/hooks/usePhotoGallery.ts"],"names":["useState","useEffect","useCamera","useFilesystem","base64FromPath","useStorage","isPlatform","CameraResultType","CameraSource","Capacitor","FilesystemDirectory","PHOTO_STORAGE","usePhotoGallery","photos","setPhotos","getPhoto","deleteFile","getUri","readFile","writeFile","get","set","loadSaved","photosString","photosInStorage","JSON","parse","photo","path","filepath","directory","Data","file","webviewPath","data","takePhoto","resultType","Uri","source","Camera","quality","cameraPhoto","fileName","Date","getTime","savePicture","savedFileImage","newPhotos","stringify","base64Data","webPath","savedFile","uri","convertFileSrc","deletePhoto","filter","p","filename","substr","lastIndexOf"],"mappings":"u0BAAA,OAASA,QAAT,CAAmBC,SAAnB,KAAoC,OAApC,CACA,OAASC,SAAT,KAA0B,2BAA1B,CACA,OAASC,aAAT,CAAwBC,cAAxB,KAA8C,+BAA9C,CACA,OAASC,UAAT,KAA2B,4BAA3B,CACA,OAASC,UAAT,KAA2B,cAA3B,CACA,OAASC,gBAAT,CAA2BC,YAA3B,CAAsDC,SAAtD,CAAiEC,mBAAjE,KAA4F,iBAA5F,CACA,GAAMC,CAAAA,aAAa,CAAG,QAAtB,CAEA,MAAO,SAASC,CAAAA,eAAT,EAA2B,eACJZ,QAAQ,CAAU,EAAV,CADJ,wCACzBa,MADyB,eACjBC,SADiB,8BAEXZ,SAAS,EAFE,CAExBa,QAFwB,YAExBA,QAFwB,oBAGoBZ,aAAa,EAHjC,CAGxBa,UAHwB,gBAGxBA,UAHwB,CAGZC,MAHY,gBAGZA,MAHY,CAGJC,QAHI,gBAGJA,QAHI,CAGMC,SAHN,gBAGMA,SAHN,iBAIXd,UAAU,EAJC,CAIxBe,GAJwB,aAIxBA,GAJwB,CAInBC,GAJmB,aAInBA,GAJmB,CAMhCpB,SAAS,CAAC,UAAM,CACd,GAAMqB,CAAAA,SAAS,0FAAG,qNACWF,CAAAA,GAAG,CAACT,aAAD,CADd,QACVY,YADU,eAEVC,eAFU,CAESD,YAAY,CAAGE,IAAI,CAACC,KAAL,CAAWH,YAAX,CAAH,CAA8B,EAFnD,CAGhB;AAHgB,GAIXjB,UAAU,CAAC,QAAD,CAJC,+DAKIkB,eALJ,8FAKLG,KALK,oCAMOT,CAAAA,QAAQ,CAAC,CAC1BU,IAAI,CAAED,KAAK,CAACE,QADc,CAE1BC,SAAS,CAAEpB,mBAAmB,CAACqB,IAFL,CAAD,CANf,SAMNC,IANM,eAUZ;AACAL,KAAK,CAACM,WAAN,kCAA8CD,IAAI,CAACE,IAAnD,EAXY,0NAchBpB,SAAS,CAACU,eAAD,CAAT,CAdgB,2EAAH,kBAATF,CAAAA,SAAS,0CAAf,CAgBAA,SAAS,GACV,CAlBQ,CAkBN,CAACF,GAAD,CAAMF,QAAN,CAlBM,CAAT,CAoBA,GAAMiB,CAAAA,SAAS,2FAAG,iNACUpB,CAAAA,QAAQ,CAAC,CACjCqB,UAAU,CAAE7B,gBAAgB,CAAC8B,GADI,CAEjCC,MAAM,CAAE9B,YAAY,CAAC+B,MAFY,CAGjCC,OAAO,CAAE,GAHwB,CAAD,CADlB,QACVC,WADU,gBAMVC,QANU,CAMC,GAAIC,CAAAA,IAAJ,GAAWC,OAAX,GAAuB,OANxB,wBAOaC,CAAAA,WAAW,CAACJ,WAAD,CAAcC,QAAd,CAPxB,QAOVI,cAPU,gBAQVC,SARU,EAQGD,cARH,4BAQsBjC,MARtB,GAShBQ,GAAG,CAACV,aAAD,CAAgBc,IAAI,CAACuB,SAAL,CAAeD,SAAf,CAAhB,CAAH,CATgB,wDAAH,kBAATZ,CAAAA,SAAS,2CAAf,CAYA,GAAMU,CAAAA,WAAW,2FAAG,kBAAOlB,KAAP,CAA2Be,QAA3B,wJAGdpC,UAAU,CAAC,QAAD,CAHI,iDAIGY,CAAAA,QAAQ,CAAC,CAC1BU,IAAI,CAAED,KAAK,CAACC,IADc,CAAD,CAJX,QAIVI,IAJU,gBAOhBiB,UAAU,CAAGjB,IAAI,CAACE,IAAlB,CAPgB,sDASG9B,CAAAA,cAAc,CAACuB,KAAK,CAACuB,OAAP,CATjB,QAShBD,UATgB,gDAWM9B,CAAAA,SAAS,CAAC,CAChCS,IAAI,CAAEc,QAD0B,CAEhCR,IAAI,CAAEe,UAF0B,CAGhCnB,SAAS,CAAEpB,mBAAmB,CAACqB,IAHC,CAAD,CAXf,SAWZoB,SAXY,oBAiBd7C,UAAU,CAAC,QAAD,CAjBI,4DAoBT,CACLuB,QAAQ,CAAEsB,SAAS,CAACC,GADf,CAELnB,WAAW,CAAExB,SAAS,CAAC4C,cAAV,CAAyBF,SAAS,CAACC,GAAnC,CAFR,CApBS,2CA4BT,CACLvB,QAAQ,CAAEa,QADL,CAELT,WAAW,CAAEN,KAAK,CAACuB,OAFd,CA5BS,2DAAH,kBAAXL,CAAAA,WAAW,iDAAjB,CAmCA,GAAMS,CAAAA,WAAW,2FAAG,kBAAO3B,KAAP,6IAClB;AACMoB,SAFY,CAEAlC,MAAM,CAAC0C,MAAP,CAAc,SAAAC,CAAC,QAAIA,CAAAA,CAAC,CAAC3B,QAAF,GAAeF,KAAK,CAACE,QAAzB,EAAf,CAFA,CAIlB;AACAR,GAAG,CAACV,aAAD,CAAgBc,IAAI,CAACuB,SAAL,CAAeD,SAAf,CAAhB,CAAH,CAEA;AACMU,QARY,CAQD9B,KAAK,CAACE,QAAN,CAAe6B,MAAf,CAAsB/B,KAAK,CAACE,QAAN,CAAe8B,WAAf,CAA2B,GAA3B,EAAkC,CAAxD,CARC,wBASZ3C,CAAAA,UAAU,CAAC,CACfY,IAAI,CAAE6B,QADS,CAEf3B,SAAS,CAAEpB,mBAAmB,CAACqB,IAFhB,CAAD,CATE,QAalBjB,SAAS,CAACiC,SAAD,CAAT,CAbkB,wDAAH,kBAAXO,CAAAA,WAAW,8CAAjB,CAgBA,MAAO,CACLA,WAAW,CAAXA,WADK,CAELzC,MAAM,CAANA,MAFK,CAGLsB,SAAS,CAATA,SAHK,CAAP,CAKD","sourcesContent":["import { useState, useEffect } from \"react\";\nimport { useCamera } from '@ionic/react-hooks/camera';\nimport { useFilesystem, base64FromPath } from '@ionic/react-hooks/filesystem';\nimport { useStorage } from '@ionic/react-hooks/storage';\nimport { isPlatform } from '@ionic/react';\nimport { CameraResultType, CameraSource, CameraPhoto, Capacitor, FilesystemDirectory } from \"@capacitor/core\";\nconst PHOTO_STORAGE = \"photos\";\n\nexport function usePhotoGallery() {\n  const [photos, setPhotos] = useState<Photo[]>([]);\n  const { getPhoto } = useCamera();\n  const { deleteFile, getUri, readFile, writeFile } = useFilesystem();\n  const { get, set } = useStorage();\n\n  useEffect(() => {\n    const loadSaved = async () => {\n      const photosString = await get(PHOTO_STORAGE);\n      const photosInStorage = (photosString ? JSON.parse(photosString) : []) as Photo[];\n      // If running on the web...\n      if (!isPlatform('hybrid')) {\n        for (let photo of photosInStorage) {\n          const file = await readFile({\n            path: photo.filepath,\n            directory: FilesystemDirectory.Data\n          });\n          // Web platform only: Load photo as base64 data\n          photo.webviewPath = `data:image/jpeg;base64,${file.data}`;\n        }\n      }\n      setPhotos(photosInStorage);\n    };\n    loadSaved();\n  }, [get, readFile]);\n\n  const takePhoto = async () => {\n    const cameraPhoto = await getPhoto({\n      resultType: CameraResultType.Uri,\n      source: CameraSource.Camera,\n      quality: 100\n    });\n    const fileName = new Date().getTime() + '.jpeg';\n    const savedFileImage = await savePicture(cameraPhoto, fileName);\n    const newPhotos = [savedFileImage, ...photos];\n    set(PHOTO_STORAGE, JSON.stringify(newPhotos));\n  };\n\n  const savePicture = async (photo: CameraPhoto, fileName: string): Promise<Photo> => {\n    let base64Data: string;\n    // \"hybrid\" will detect Cordova or Capacitor;\n    if (isPlatform('hybrid')) {\n      const file = await readFile({\n        path: photo.path!\n      });\n      base64Data = file.data;\n    } else {\n      base64Data = await base64FromPath(photo.webPath!);\n    }\n    const savedFile = await writeFile({\n      path: fileName,\n      data: base64Data,\n      directory: FilesystemDirectory.Data\n    });\n\n    if (isPlatform('hybrid')) {\n      // Display the new image by rewriting the 'file://' path to HTTP\n      // Details: https://ionicframework.com/docs/building/webview#file-protocol\n      return {\n        filepath: savedFile.uri,\n        webviewPath: Capacitor.convertFileSrc(savedFile.uri),\n      };\n    }\n    else {\n      // Use webPath to display the new image instead of base64 since it's\n      // already loaded into memory\n      return {\n        filepath: fileName,\n        webviewPath: photo.webPath\n      };\n    }\n  };\n\n  const deletePhoto = async (photo: Photo) => {\n    // Remove this photo from the Photos reference data array\n    const newPhotos = photos.filter(p => p.filepath !== photo.filepath);\n\n    // Update photos array cache by overwriting the existing photo array\n    set(PHOTO_STORAGE, JSON.stringify(newPhotos));\n\n    // delete photo file from filesystem\n    const filename = photo.filepath.substr(photo.filepath.lastIndexOf('/') + 1);\n    await deleteFile({\n      path: filename,\n      directory: FilesystemDirectory.Data\n    });\n    setPhotos(newPhotos);\n  };\n\n  return {\n    deletePhoto,\n    photos,\n    takePhoto\n  };\n}\nexport interface Photo {\n  filepath: string;\n  webviewPath?: string;\n}\n"]},"metadata":{},"sourceType":"module"}