{"ast":null,"code":"import _slicedToArray from \"/Users/pranavmainkar/Sites/photo-gallery/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _regeneratorRuntime from \"/Users/pranavmainkar/Sites/photo-gallery/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/pranavmainkar/Sites/photo-gallery/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\n// Inspired by useLocalStorage from https://usehooks.com/useLocalStorage/\nimport { useState, useEffect, useCallback } from 'react';\nimport { Plugins } from '@capacitor/core';\nimport { notAvailable } from '../util/models';\nimport { isFeatureAvailable, featureNotAvailableError } from '../util/feature-check';\nexport var availableFeatures = {\n  useStorage: isFeatureAvailable('Storage', 'useStorage')\n};\nexport function useStorage() {\n  var Storage = Plugins.Storage;\n\n  if (!availableFeatures.useStorage) {\n    return Object.assign({\n      get: featureNotAvailableError,\n      set: featureNotAvailableError,\n      remove: featureNotAvailableError,\n      getKeys: featureNotAvailableError,\n      clear: featureNotAvailableError\n    }, notAvailable);\n  }\n\n  var get = useCallback( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(key) {\n      var v;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return Storage.get({\n                key: key\n              });\n\n            case 2:\n              v = _context.sent;\n\n              if (!v) {\n                _context.next = 5;\n                break;\n              }\n\n              return _context.abrupt(\"return\", v.value);\n\n            case 5:\n              return _context.abrupt(\"return\", null);\n\n            case 6:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }(), []);\n  var set = useCallback(function (key, value) {\n    return Storage.set({\n      key: key,\n      value: value\n    });\n  }, []);\n  var remove = useCallback(function (key) {\n    return Storage.remove({\n      key: key\n    });\n  }, []);\n  var getKeys = useCallback(function () {\n    return Storage.keys();\n  }, []);\n  var clear = useCallback(function () {\n    return Storage.clear();\n  }, []);\n  return {\n    get: get,\n    set: set,\n    remove: remove,\n    getKeys: getKeys,\n    clear: clear,\n    isAvailable: true\n  };\n}\nexport function useStorageItem(key, initialValue) {\n  var Storage = Plugins.Storage;\n\n  if (!availableFeatures.useStorage) {\n    return [undefined, featureNotAvailableError, false];\n  }\n\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      storedValue = _useState2[0],\n      setStoredValue = _useState2[1];\n\n  useEffect(function () {\n    function loadValue() {\n      return _loadValue.apply(this, arguments);\n    }\n\n    function _loadValue() {\n      _loadValue = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n        var result;\n        return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                _context2.prev = 0;\n                _context2.next = 3;\n                return Storage.get({\n                  key: key\n                });\n\n              case 3:\n                result = _context2.sent;\n\n                if (result.value == undefined && initialValue != undefined) {\n                  result.value = typeof initialValue === \"string\" ? initialValue : JSON.stringify(initialValue);\n                  setValue(result.value);\n                } else {\n                  setStoredValue(typeof result.value === 'string' ? result.value : JSON.parse(result.value));\n                }\n\n                _context2.next = 10;\n                break;\n\n              case 7:\n                _context2.prev = 7;\n                _context2.t0 = _context2[\"catch\"](0);\n                return _context2.abrupt(\"return\", initialValue);\n\n              case 10:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, null, [[0, 7]]);\n      }));\n      return _loadValue.apply(this, arguments);\n    }\n\n    loadValue();\n  }, [Storage, setStoredValue, initialValue, key]);\n\n  var setValue = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(value) {\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.prev = 0;\n              setStoredValue(value);\n              _context3.next = 4;\n              return Storage.set({\n                key: key,\n                value: typeof value === \"string\" ? value : JSON.stringify(value)\n              });\n\n            case 4:\n              _context3.next = 9;\n              break;\n\n            case 6:\n              _context3.prev = 6;\n              _context3.t0 = _context3[\"catch\"](0);\n              console.error(_context3.t0);\n\n            case 9:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[0, 6]]);\n    }));\n\n    return function setValue(_x2) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  return [storedValue, setValue, true];\n}","map":{"version":3,"sources":["../../src/storage/useStorage.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["// Inspired by useLocalStorage from https://usehooks.com/useLocalStorage/\nimport { useState, useEffect, useCallback } from 'react';\nimport { Plugins } from '@capacitor/core';\nimport { notAvailable } from '../util/models';\nimport { isFeatureAvailable, featureNotAvailableError } from '../util/feature-check';\nexport const availableFeatures = {\n    useStorage: isFeatureAvailable('Storage', 'useStorage')\n};\nexport function useStorage() {\n    const { Storage } = Plugins;\n    if (!availableFeatures.useStorage) {\n        return Object.assign({ get: featureNotAvailableError, set: featureNotAvailableError, remove: featureNotAvailableError, getKeys: featureNotAvailableError, clear: featureNotAvailableError }, notAvailable);\n    }\n    const get = useCallback(async (key) => {\n        const v = await Storage.get({ key });\n        if (v) {\n            return v.value;\n        }\n        return null;\n    }, []);\n    const set = useCallback((key, value) => {\n        return Storage.set({ key, value: value });\n    }, []);\n    const remove = useCallback((key) => {\n        return Storage.remove({ key });\n    }, []);\n    const getKeys = useCallback(() => {\n        return Storage.keys();\n    }, []);\n    const clear = useCallback(() => {\n        return Storage.clear();\n    }, []);\n    return { get, set, remove, getKeys, clear, isAvailable: true };\n}\nexport function useStorageItem(key, initialValue) {\n    const { Storage } = Plugins;\n    if (!availableFeatures.useStorage) {\n        return [\n            undefined,\n            featureNotAvailableError,\n            false\n        ];\n    }\n    const [storedValue, setStoredValue] = useState();\n    useEffect(() => {\n        async function loadValue() {\n            try {\n                const result = await Storage.get({ key });\n                if (result.value == undefined && initialValue != undefined) {\n                    result.value = typeof initialValue === \"string\" ? initialValue : JSON.stringify(initialValue);\n                    setValue(result.value);\n                }\n                else {\n                    setStoredValue(typeof result.value === 'string' ? result.value : JSON.parse(result.value));\n                }\n            }\n            catch (e) {\n                return initialValue;\n            }\n        }\n        loadValue();\n    }, [Storage, setStoredValue, initialValue, key]);\n    const setValue = async (value) => {\n        try {\n            setStoredValue(value);\n            await Storage.set({ key, value: typeof value === \"string\" ? value : JSON.stringify(value) });\n        }\n        catch (e) {\n            console.error(e);\n        }\n    };\n    return [\n        storedValue,\n        setValue,\n        true\n    ];\n}\n//# sourceMappingURL=useStorage.js.map"]},"metadata":{},"sourceType":"module"}