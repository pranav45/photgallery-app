{"ast":null,"code":"import { useState, useEffect } from \"react\";\nimport { useCamera } from '@ionic/react-hooks/camera';\nimport { useFilesystem, base64FromPath } from '@ionic/react-hooks/filesystem';\nimport { useStorage } from '@ionic/react-hooks/storage';\nimport { isPlatform } from '@ionic/react';\nimport { CameraResultType, CameraSource, Capacitor, FilesystemDirectory } from \"@capacitor/core\";\nconst PHOTO_STORAGE = \"photos\";\nexport function usePhotoGallery() {\n  const [photos, setPhotos] = useState([]);\n  const {\n    getPhoto\n  } = useCamera();\n  const {\n    deleteFile,\n    readFile,\n    writeFile\n  } = useFilesystem();\n  const {\n    get,\n    set\n  } = useStorage();\n  useEffect(() => {\n    const loadSaved = async () => {\n      const photosString = await get(PHOTO_STORAGE);\n      const photosInStorage = photosString ? JSON.parse(photosString) : []; // If running on the web...\n\n      if (!isPlatform('hybrid')) {\n        for (let photo of photosInStorage) {\n          const file = await readFile({\n            path: photo.filepath,\n            directory: FilesystemDirectory.Data\n          }); // Web platform only: Load the photo as base64 data\n\n          photo.webviewPath = `data:image/jpeg;base64,${file.data}`;\n        }\n      }\n\n      setPhotos(photosInStorage);\n    };\n\n    loadSaved();\n  }, [get, readFile]);\n\n  const takePhoto = async () => {\n    const cameraPhoto = await getPhoto({\n      resultType: CameraResultType.Uri,\n      source: CameraSource.Camera,\n      quality: 100\n    });\n    const fileName = new Date().getTime() + '.jpeg';\n    const savedFileImage = await savePicture(cameraPhoto, fileName);\n    const newPhotos = [savedFileImage, ...photos];\n    setPhotos(newPhotos);\n    set(PHOTO_STORAGE, JSON.stringify(newPhotos));\n  };\n\n  const savePicture = async (photo, fileName) => {\n    let base64Data; // \"hybrid\" will detect Cordova or Capacitor;\n\n    if (isPlatform('hybrid')) {\n      const file = await readFile({\n        path: photo.path\n      });\n      base64Data = file.data;\n    } else {\n      base64Data = await base64FromPath(photo.webPath);\n    }\n\n    const savedFile = await writeFile({\n      path: fileName,\n      data: base64Data,\n      directory: FilesystemDirectory.Data\n    });\n\n    if (isPlatform('hybrid')) {\n      // Display the new image by rewriting the 'file://' path to HTTP\n      // Details: https://ionicframework.com/docs/building/webview#file-protocol\n      return {\n        filepath: savedFile.uri,\n        webviewPath: Capacitor.convertFileSrc(savedFile.uri)\n      };\n    } else {\n      // Use webPath to display the new image instead of base64 since it's\n      // already loaded into memory\n      return {\n        filepath: fileName,\n        webviewPath: photo.webPath\n      };\n    }\n  };\n\n  const deletePhoto = async photo => {\n    // Remove this photo from the Photos reference data array\n    const newPhotos = photos.filter(p => p.filepath !== photo.filepath); // Update photos array cache by overwriting the existing photo array\n\n    set(PHOTO_STORAGE, JSON.stringify(newPhotos)); // delete photo file from filesystem\n\n    const filename = photo.filepath.substr(photo.filepath.lastIndexOf('/') + 1);\n    await deleteFile({\n      path: filename,\n      directory: FilesystemDirectory.Data\n    });\n    setPhotos(newPhotos);\n  };\n\n  return {\n    deletePhoto,\n    photos,\n    takePhoto\n  };\n}","map":{"version":3,"sources":["/Users/pranavmainkar/Sites/photogallery-app/src/hooks/usePhotoGallery.ts"],"names":["useState","useEffect","useCamera","useFilesystem","base64FromPath","useStorage","isPlatform","CameraResultType","CameraSource","Capacitor","FilesystemDirectory","PHOTO_STORAGE","usePhotoGallery","photos","setPhotos","getPhoto","deleteFile","readFile","writeFile","get","set","loadSaved","photosString","photosInStorage","JSON","parse","photo","file","path","filepath","directory","Data","webviewPath","data","takePhoto","cameraPhoto","resultType","Uri","source","Camera","quality","fileName","Date","getTime","savedFileImage","savePicture","newPhotos","stringify","base64Data","webPath","savedFile","uri","convertFileSrc","deletePhoto","filter","p","filename","substr","lastIndexOf"],"mappings":"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","sourcesContent":["import { useState, useEffect } from \"react\";\nimport { useCamera } from '@ionic/react-hooks/camera';\nimport { useFilesystem, base64FromPath } from '@ionic/react-hooks/filesystem';\nimport { useStorage } from '@ionic/react-hooks/storage';\nimport { isPlatform } from '@ionic/react';\nimport { CameraResultType, CameraSource, CameraPhoto, Capacitor, FilesystemDirectory } from \"@capacitor/core\";\n\nconst PHOTO_STORAGE = \"photos\";\n\nexport function usePhotoGallery() {\n\n  const [photos, setPhotos] = useState<Photo[]>([]);\n  const { getPhoto } = useCamera();\n  const { deleteFile, readFile, writeFile } = useFilesystem();\n  const { get, set } = useStorage();\n\n  useEffect(() => {\n    const loadSaved = async () => {\n      const photosString = await get(PHOTO_STORAGE);\n      const photosInStorage = (photosString ? JSON.parse(photosString) : []) as Photo[];\n      // If running on the web...\n      if (!isPlatform('hybrid')) {\n        for (let photo of photosInStorage) {\n          const file = await readFile({\n            path: photo.filepath,\n            directory: FilesystemDirectory.Data\n          });\n          // Web platform only: Load the photo as base64 data\n          photo.webviewPath = `data:image/jpeg;base64,${file.data}`;\n        }\n      }\n      setPhotos(photosInStorage);\n    };\n    loadSaved();\n  }, [get, readFile]);\n\n  const takePhoto = async () => {\n    const cameraPhoto = await getPhoto({\n      resultType: CameraResultType.Uri,\n      source: CameraSource.Camera,\n      quality: 100\n    });\n    const fileName = new Date().getTime() + '.jpeg';\n    const savedFileImage = await savePicture(cameraPhoto, fileName);\n    const newPhotos = [savedFileImage, ...photos];\n    setPhotos(newPhotos);\n    set(PHOTO_STORAGE, JSON.stringify(newPhotos));\n  };\n\n  const savePicture = async (photo: CameraPhoto, fileName: string): Promise<Photo> => {\n    let base64Data: string;\n    // \"hybrid\" will detect Cordova or Capacitor;\n    if (isPlatform('hybrid')) {\n      const file = await readFile({\n        path: photo.path!\n      });\n      base64Data = file.data;\n    } else {\n      base64Data = await base64FromPath(photo.webPath!);\n    }\n    const savedFile = await writeFile({\n      path: fileName,\n      data: base64Data,\n      directory: FilesystemDirectory.Data\n    });\n\n    if (isPlatform('hybrid')) {\n      // Display the new image by rewriting the 'file://' path to HTTP\n      // Details: https://ionicframework.com/docs/building/webview#file-protocol\n      return {\n        filepath: savedFile.uri,\n        webviewPath: Capacitor.convertFileSrc(savedFile.uri),\n      };\n    }\n    else {\n      // Use webPath to display the new image instead of base64 since it's\n      // already loaded into memory\n      return {\n        filepath: fileName,\n        webviewPath: photo.webPath\n      };\n    }\n  };\n\n  const deletePhoto = async (photo: Photo) => {\n    // Remove this photo from the Photos reference data array\n    const newPhotos = photos.filter(p => p.filepath !== photo.filepath);\n\n    // Update photos array cache by overwriting the existing photo array\n    set(PHOTO_STORAGE, JSON.stringify(newPhotos));\n\n    // delete photo file from filesystem\n    const filename = photo.filepath.substr(photo.filepath.lastIndexOf('/') + 1);\n    await deleteFile({\n      path: filename,\n      directory: FilesystemDirectory.Data\n    });\n    setPhotos(newPhotos);\n  };\n\n  return {\n    deletePhoto,\n    photos,\n    takePhoto\n  };\n}\n\nexport interface Photo {\n  filepath: string;\n  webviewPath?: string;\n}\n"]},"metadata":{},"sourceType":"module"}